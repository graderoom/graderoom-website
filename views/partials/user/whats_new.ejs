<!-- What's New Card -->
<div class="blurred-login" id="latestDisplay">
    <div class="blurred-background"></div>
    <div class="col-sm-11 col-md-10 col-lg-9 col-xl-8 mx-auto">
        <div id="latestCard" class="card card-signin my-5">
            <btn class="btn btn-md"
                 onclick="closeForm('latestDisplay')"
                 style="width: fit-content; width: -moz-fit-content; margin-bottom:0;">
                <i class="fa fa-close" aria-hidden="true"></i> Close
            </btn>
            <btn class="btn btn-med" onclick="showChangelog()"
                 style="position: absolute; width: fit-content; width: -moz-fit-content; right: 0; margin-bottom: 0">
                View Full Changelog <i class="fa fa-external-link-square"></i></btn>
            <div class="card-body">
                <h4 class="card-title text-center"><span class="fa fa-clock-o"></span>
                    A New Version Has Been Released
                </h4>
                <div style="display: flex; flex-flow: column; align-content: space-around">
                    <div class="card changelog">
                        <div id="latest-container" class="changelog-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

    let latestContainer = $("#latest-container");

    function showLatest(force) {
        $.ajax({
                   url: "/latestVersion", type: "GET", async: true
               }).done(function (response) {
            if (response.startsWith("<!")) {  // If logged out
                $(".session-timeout").show();
                $("body").find("*").not(".session-timeout").remove();
                return;
            }
            let versionTitle = $(response)[0].childNodes[0].childNodes[0].innerText;
            versionTitle = versionTitle.substring(versionTitle.indexOf(" ") + 1);
            if (versionTitle !== alerts.latestSeen || force) {
                $("#latestDisplay").fadeIn(500);
                latestContainer.html(response);
                latestContainer.animate({scrollTop: 0}, 0);
                if (cardsDisplayed.includes("latestDisplay")) {
                    cardsDisplayed.splice(cardsDisplayed.indexOf("latestDisplay"), 1);
                }
                cardsDisplayed.push("latestDisplay");
                $(".blurred-background").each(function () {
                    if (cardsDisplayed.includes($($(this).parent())[0].id)) {
                        $(this).parent().css("z-index", cardsDisplayed.indexOf($($(this).parent())[0].id) + minCardZIndex);
                    }
                });
                $.ajax({
                           url: "/latestVersionSeen", type: "POST", async: true
                       }).done((response) => {
                    if (response.startsWith("<!")) {  // If logged out
                        $(".session-timeout").show();
                        $("body").find("*").not(".session-timeout").remove();
                    }
                });
            }
        });

    }
</script>
